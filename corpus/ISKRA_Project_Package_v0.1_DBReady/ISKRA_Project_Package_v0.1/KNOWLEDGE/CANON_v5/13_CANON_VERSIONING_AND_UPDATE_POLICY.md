# 13. ВЕРСИОНИРОВАНИЕ КАНОНА И ПОЛИТИКА ОБНОВЛЕНИЙ

## Введение: Живой Канон

Канон Искры — это **живой документ**, который должен эволюционировать на основе опыта и ошибок. Политика версионирования обеспечивает **трассируемость** изменений и предотвращает **дрейф** системы.

## 1. Версионирование Канона

### 1.1. Структура Версии

Версия Канона (например, **V5**) отражает значительные изменения в **Манифесте** (`File 01`) или **Архитектуре** (`File 03`).

| Тип Изменения | Описание | Обновляемый Файл |
| :--- | :--- | :--- |
| **Major** (V5 -> V6) | Изменение принципов, архитектуры, добавление/удаление голосов. | `File 01`, `File 03`. |
| **Minor** (V5.1 -> V5.2) | Изменение формул метрик, порогов фаз, добавление/удаление ритуалов. | `File 05`, `File 06`. |
| **Patch** (V5.2.1) | Исправление опечаток, уточнение формулировок, обновление `INSTRUCTIONS_ISKRA_PROJECTS`. | `File 10`. |

### 1.2. Canon Feedback Loop (Контур Обратной Связи)

**Canon Feedback Loop** (`File 02`) — это основной механизм для инициирования изменений.

1.  **Триггер:** Обнаружение разрыва между Каноном и Реальностью (например, "гладко, но пусто").
2.  **Фиксация:** Создание `CanonFeedbackEntry` (`NodeType.CANON_FEEDBACK`) в гиперграфе.
3.  **Аудит:** Запуск `Canon Review` (`File 06`) для оценки предложения.
4.  **GrowthNode:** Успешное изменение Канона фиксируется как `GrowthNode` (`NodeType.GROWTH`) в гиперграфе, что повышает `integrity` и `trust`.

## 2. Политика Обновлений

### 2.1. Процесс Обновления

1.  **Аудит:** Проверка всех 15 файлов на согласованность (Canon Review).
2.  **Тестирование:** Прогон всех **Evals** (`File 14`) на новой версии.
3.  **Синхронизация:** Обновление `INSTRUCTIONS_ISKRA_PROJECTS` (`File 10`) и `OpenAPI-спецификации` (`File 11`).
4.  **Уведомление:** Система должна уведомить Субъекта о Major-обновлении, используя `FacetType.SIBYL` (Переход).

### 2.2. GrowthNode (Узел Роста)

**GrowthNode** — это узел в гиперграфе, который фиксирует **урок, извлеченный из ошибки или инсайта**.

| Поле | Описание |
| :--- | :--- |
| **lesson_learned** | Краткое описание урока. |
| **canon_version_before** | Версия Канона до изменения. |
| **canon_version_after** | Версия Канона после изменения. |
| **related_feedback_id** | Ссылка на `CanonFeedbackEntry`, который привел к росту. |

## 3. Требования к Коду

*   **Использование Enum:** Все ключевые сущности (FacetType, PhaseType, NodeType) должны быть реализованы как `Enum` в `core.models.py` для обеспечения строгой типизации и предотвращения ошибок версионирования.
*   **Миграции:** Изменения в структуре данных (`IskraMetrics`, `AdomlBlock`) должны сопровождаться скриптами миграции.

---
**Связанные файлы:** 01, 02, 03, 05, 06, 10, 11, 14.
**Ключевые сущности (core.models):** `CanonFeedbackEntry`, `NodeType.GROWTH`, `FacetType`, `PhaseType`.


## Дополнение v5.1 · Минорный релиз под ChatGPT Projects / Business

Эта версия Канона (v5.1):

- основана на v5.0, описанной в финальном отчёте «МАКСИМАЛЬНАЯ ДОРАБОТКА КАНОНА ИСКРЫ»;
- добавляет:
  - уточнения по работе с Company Knowledge и Deep Research;
  - уточнения по ограничениям среды ChatGPT Projects / Business (отсутствие фоновой работы);
  - обновлённую OpenAPI-спеку `Iskra Core API` (OpenAPI 3.1.0);
  - более точные связи между файлами Канона и модулями ядра.

Правило миграции:

- Любые ссылки вида «v5.0» в старых документах считаются совместимыми с v5.1,
  если явно не указано обратное.
- При существенных изменениях смыслов (а не только инфраструктуры) версия должна
  повышаться до v6.x с отдельным миграционным документом.
