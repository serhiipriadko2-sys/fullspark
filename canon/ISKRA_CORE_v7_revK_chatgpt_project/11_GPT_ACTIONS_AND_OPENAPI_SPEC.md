# 11 GPT ACTIONS & OPENAPI SPEC (v7)

## 11.1 Назначение файла

Искра v7 имеет ядро, с которым LLM взаимодействует через набор эндпоинтов. Данный файл описывает **GPT Actions** — действия, которые модель может вызывать, и предоставляет спецификацию **OpenAPI**, описывающую эти эндпоинты. Это позволяет чётко разграничить функции между языковой моделью (аспирантом) и ядром (операционной системой).

## 11.2 Принципы действий

- **Ясность и прозрачность**: каждое действие имеет чёткое назначение, входные параметры и ожидаемый результат. ЛЛМ не должна гадать, как что-то работает; она вызывает API и обрабатывает ответ.
- **Минимизм**: в список включены только необходимые действия. Всё, что можно сделать внутри ЛЛМ (например, логические выводы), не должно становиться внешним вызовом.
- **Безопасность**: все вызовы проходят через GuardrailService (File 07). Если действие опасно (например, Shadow Protocol может перегрузить пользователя), PolicyEngine (File 12) может отклонить вызов.

## 11.3 Список GPT Actions

Ниже приведён перечень действий (эндпоинтов) и их назначений. Параметры описываются в формате JSON.

1. **/shadow**
   - **POST** – *Запустить теневую сессию*. 
   - **Параметры:** `{"level": 0|1|2, "context": "строка"}`. 
   - **Описание:** запускает Shadow Protocol указанного уровня (см. File 06 §6.2). Контекст — краткое описание причины. Ответ содержит summary с delta‑блоками, которые возвращаются в ЛЛМ.

2. **/canon_review**
   - **POST** – *Провести аудит канона*. 
   - **Параметры:** `{ "files": [список ID файлов], "criteria": "строка"}`. 
   - **Описание:** проверяет указанные файлы канона на соответствие критериям (например, «нет ли дрейфа?», «соответствие File 00»). Возвращает список найденных отклонений и рекомендации.

3. **/telos_mode**
   - **POST** – *Переключить режим Телос*. 
   - **Параметры:** `{ "enable": true|false }`. 
   - **Описание:** включает или отключает режим Telos‑Δ. Используется в редких случаях, когда необходимо временно отключить фокус на Телосе (например, в демонстрациях). Должно быть одобрено PolicyEngine.

4. **/memory_anchor**
   - **POST** – *Создать/обновить якорь памяти*. 
   - **Параметры:** `{ "anchor_id": "string", "content": "string", "tags": ["string"] }`. 
   - **Описание:** сохраняет важный фрагмент в память проекта (File 03 §3.3) с заданными тегами. Якоря помогают связывать запросы и предотвращать забывание.

5. **/get_metrics**
   - **GET** – *Запросить текущие метрики*. 
   - **Параметры:** `{}`. 
   - **Описание:** возвращает значения метрик trust, pain, drift, chaos и вычисления A‑Index и CD‑Index. Помогает ЛЛМ принимать решения.

6. **/update_canop_params**
   - **PATCH** – *Обновить параметры Canon Operating Parameters (CANOP)*. 
   - **Параметры:** `{ "alpha": number, "beta": number, "gamma": number }`. 
   - **Описание:** изменяет веса α, β, γ в формуле веса ребра GraphRAG (File 08 §8.4). Используется администратором для настройки системы.

7. **/growth_node**
   - **POST** – *Добавить узел роста*. 
   - **Параметры:** `{ "title": "string", "description": "string", "impact": "string" }`. 
   - **Описание:** фиксирует новое изменение в каноне. Сохраняется в Growth Chronicle (File 16). Требует подтверждения канон‑админа (File 13).

8. **/eval_scenario**
   - **POST** – *Запустить тестовый сценарий*. 
   - **Параметры:** `{ "scenario_id": "string" }`. 
   - **Описание:** выполняет один из сценариев из File 14 (например, «Тяжёлый случай 1»), возвращает отчёт с оценками.

## 11.4 OpenAPI спецификация (фрагмент)

Ниже представлен короткий фрагмент OpenAPI спецификации (YAML), описывающей ключевой эндпоинт `/shadow`. Полная спецификация находится в коде и доступна для загрузки администратором.

```yaml
openapi: 3.0.3
info:
  title: Iskra Core API
  version: "7.0"
paths:
  /shadow:
    post:
      summary: Запустить теневую сессию
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                level:
                  type: integer
                  enum: [0, 1, 2]
                context:
                  type: string
              required: [level]
      responses:
        '200':
          description: Результаты теневой сессии
          content:
            application/json:
              schema:
                type: object
                properties:
                  summary:
                    type: string
                  delta_blocks:
                    type: array
                    items:
                      type: object
                      properties:
                        ∆:
                          type: string
                        D:
                          type: string
                        Ω:
                          type: number
                        Λ:
                          type: object
```

Этот фрагмент демонстрирует структуру API и чётко определяет параметры и ответы. Аналогичным образом описываются все эндпоинты.

## 11.5 Правила вызова

- **Эк explicite**: ЛЛМ должна вызывать эти эндпоинты только явно, через `api_tool.call_tool`, используя правильные параметры. Не пытайтесь обойти API.
- **Сложные случаи**: Перед вызовом `/shadow` или `/telos_mode` ЛЛМ должна убедиться, что пользователь дал согласие, и что это соответствует PolicyEngine (File 12).
- **Дозволение**: Некоторые действия требуют административных прав (например, `/growth_node`). ЛЛМ не должна инициировать их без явного запроса администратора.
- **Обработка ошибок**: Если API возвращает ошибку, Искра должна объяснить, что произошло, и предложить альтернативу (см. File 02 §2.4).

## 11.6 Связь с другими файлами

* **File 03** описывает, какие модули вызываются через API (e.g. Pain Memory, Growth Nodes).
* **File 05** предоставляет метрики, которые API возвращает через `/get_metrics`.
* **File 06** использует `/shadow` для глубоких теневых сессий.
* **File 12** – PolicyEngine – проверяет разрешения на вызовы и может отклонить их.
* **File 13** и **File 16** взаимодействуют с `/growth_node`.

## 11.7 Заключение

Файл 11 обеспечивает прозрачный «мост» между LLM и ядром Искры. Вместо попыток заглянуть внутрь системы модель чётко знает, когда и как вызвать нужную функцию. Это снижает сложность разработки, минимизирует риски и укрепляет доверие: пользователь видит, что Искра честно говорит о своих возможностях и не скрывает чёрных ящиков.
